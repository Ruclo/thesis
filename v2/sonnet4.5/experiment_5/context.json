{
  "repository": {
    "name": "openshift-virtualization-tests",
    "primary_language": "python",
    "test_framework": "pytest",
    "resource_library": "openshift-python-wrapper (ocp_resources)"
  },
  "utilities": {
    "classes": [
      "VirtualMachineForTests",
      "DataVolumeForTests",
      "ClusterHosts",
      "ExecCommandOnPod",
      "HppCsiStorageClass",
      "PodWithPVC",
      "VirtualMachineSnapshotWithDeadline"
    ],
    "methods": {
      "virt": [
        "fedora_vm_body",
        "running_vm",
        "wait_for_ssh_connectivity",
        "wait_for_vm_interfaces",
        "wait_for_migration_finished",
        "migrate_vm_and_verify",
        "generate_cloud_init_data",
        "get_guest_agent_interfaces"
      ],
      "storage": [
        "create_dv",
        "create_dummy_first_consumer_pod",
        "get_default_storage_class",
        "is_snapshot_supported_by_sc",
        "wait_for_volume_snapshot_ready_to_use",
        "create_cirros_dv_for_snapshot_dict",
        "write_file",
        "run_command_on_cirros_vm_and_check_output"
      ],
      "infra": [
        "create_ns",
        "get_clusterversion",
        "get_csv_related_images",
        "set_permissions"
      ],
      "matrix": [
        "snapshot_matrix",
        "wffc_matrix",
        "hpp_matrix",
        "online_resize_matrix",
        "volume_mode_matrix"
      ]
    },
    "constants": {
      "timeouts": [
        "TIMEOUT_1SEC",
        "TIMEOUT_5SEC",
        "TIMEOUT_10SEC",
        "TIMEOUT_20SEC",
        "TIMEOUT_1MIN",
        "TIMEOUT_5MIN",
        "TIMEOUT_10MIN",
        "TIMEOUT_12MIN",
        "TIMEOUT_25MIN",
        "TIMEOUT_30MIN"
      ],
      "images": [
        "Images.Cirros.QCOW2_IMG",
        "Images.Cirros.RAW_IMG",
        "Images.Cirros.DEFAULT_DV_SIZE",
        "Images.Fedora.FEDORA42_IMG",
        "Images.Fedora.FEDORA43_IMG"
      ],
      "storage_classes": [
        "StorageClassNames.HOSTPATH",
        "StorageClassNames.HOSTPATH_CSI",
        "StorageClassNames.OCS_STORAGECLUSTER_CEPHFS",
        "StorageClassNames.OCS_STORAGECLUSTER_RBD"
      ],
      "os_flavors": [
        "OS_FLAVOR_CIRROS",
        "OS_FLAVOR_RHEL",
        "OS_FLAVOR_FEDORA",
        "OS_FLAVOR_WINDOWS"
      ],
      "other": [
        "HCO_NAMESPACE",
        "UNPRIVILEGED_USER",
        "LS_COMMAND",
        "NODE_TYPE_WORKER_LABEL",
        "SPEC_STR",
        "STATUS_STR"
      ]
    }
  },
  "fixtures": {
    "session_scope": [
      "admin_client",
      "unprivileged_client",
      "nodes",
      "schedulable_nodes",
      "workers",
      "hco_namespace",
      "csv_scope_session",
      "cluster_storage_classes",
      "storage_class_for_snapshot",
      "skip_if_no_storage_class_for_snapshot",
      "artifactory_secret_scope_session",
      "artifactory_config_map_scope_session"
    ],
    "module_scope": [
      "namespace",
      "storage_class_matrix__module__",
      "storage_class_matrix_snapshot_matrix__module__",
      "snapshot_storage_class_name_scope_module",
      "artifactory_secret_scope_module",
      "artifactory_config_map_scope_module"
    ],
    "function_scope": [
      "data_volume_scope_function",
      "cirros_vm_for_snapshot",
      "snapshots_with_content",
      "windows_vm_for_snapshot",
      "windows_snapshot",
      "permissions_for_dv",
      "storage_profile_with_snapshotclass"
    ],
    "scopes": {
      "admin_client": "session",
      "unprivileged_client": "session",
      "namespace": "module",
      "storage_class_matrix__module__": "module",
      "data_volume_scope_function": "function",
      "cirros_vm_for_snapshot": "function",
      "snapshots_with_content": "function"
    },
    "parametrized_fixtures": [
      "cirros_vm_name",
      "snapshots_with_content",
      "windows_vm_for_snapshot",
      "chaos_online_snapshots"
    ]
  },
  "imports": {
    "pytest": [
      "import logging",
      "import pytest",
      "from timeout_sampler import TimeoutExpiredError, TimeoutSampler"
    ],
    "ocp_resources": [
      "from ocp_resources.datavolume import DataVolume",
      "from ocp_resources.namespace import Namespace",
      "from ocp_resources.pod import Pod",
      "from ocp_resources.secret import Secret",
      "from ocp_resources.storage_class import StorageClass",
      "from ocp_resources.storage_profile import StorageProfile",
      "from ocp_resources.virtual_machine import VirtualMachine",
      "from ocp_resources.virtual_machine_snapshot import VirtualMachineSnapshot",
      "from ocp_resources.virtual_machine_restore import VirtualMachineRestore",
      "from ocp_resources.volume_snapshot import VolumeSnapshot",
      "from ocp_resources.volume_snapshot_class import VolumeSnapshotClass",
      "from ocp_resources.resource import ResourceEditor"
    ],
    "kubernetes": [
      "from kubernetes.client.rest import ApiException",
      "from kubernetes.dynamic.exceptions import ResourceNotFoundError"
    ],
    "utilities": [
      "from utilities.constants import TIMEOUT_1MIN, TIMEOUT_5MIN, TIMEOUT_10MIN",
      "from utilities.virt import VirtualMachineForTests, running_vm, wait_for_ssh_connectivity",
      "from utilities.storage import create_dv, is_snapshot_supported_by_sc",
      "from utilities.infra import ExecCommandOnPod, create_ns"
    ]
  },
  "conventions": {
    "markers": {
      "polarion": "@pytest.mark.polarion('CNV-XXXXX')",
      "gating": "@pytest.mark.gating()",
      "tier": "@pytest.mark.tier1 / @pytest.mark.tier2",
      "smoke": "@pytest.mark.smoke",
      "architecture": "@pytest.mark.s390x / @pytest.mark.arm64 / @pytest.mark.x86_64",
      "domain": "@pytest.mark.storage / @pytest.mark.virt / @pytest.mark.network",
      "sno": "@pytest.mark.sno",
      "parametrize": "@pytest.mark.parametrize(...)",
      "usefixtures": "@pytest.mark.usefixtures(...)"
    },
    "naming": {
      "test_files": "test_<feature_name>.py",
      "test_classes": "Test<FeatureName>",
      "test_methods": "test_<feature>_<scenario>",
      "fixtures": "<noun>_scope_<scope> or <noun>",
      "constants": "UPPERCASE_WITH_UNDERSCORES",
      "variables": "lowercase_with_underscores"
    },
    "file_structure": {
      "pattern": "tests/<domain>/<feature>/test_*.py",
      "conftest": "tests/<domain>/conftest.py or tests/<domain>/<feature>/conftest.py",
      "constants": "tests/<domain>/constants.py or tests/<domain>/<feature>/constants.py",
      "utils": "tests/<domain>/utils.py or tests/<domain>/<feature>/utils.py"
    },
    "docstring_format": "Google-style with Args/Returns/Raises sections",
    "context_managers": "Use 'with' statements for resource lifecycle management",
    "logging": "LOGGER = logging.getLogger(__name__) at module level"
  },
  "precedents": {
    "snapshot_tests": [
      "tests/storage/snapshots/test_snapshots.py",
      "tests/storage/snapshots/conftest.py",
      "tests/storage/snapshots/constants.py",
      "tests/storage/snapshots/utils.py"
    ],
    "storage_tests": [
      "tests/storage/test_datavolumes.py",
      "tests/storage/test_storage_class.py",
      "tests/storage/checkups/test_storage_checkup.py"
    ],
    "vm_lifecycle_tests": [
      "tests/virt/cluster/test_vm_reset.py",
      "tests/virt/lifecycle/test_vm_lifecycle.py"
    ],
    "similar_patterns": {
      "storageprofile": [
        "tests/storage/checkups/conftest.py:updated_default_storage_profile",
        "tests/storage/checkups/conftest.py:updated_storage_class_snapshot_clone_strategy"
      ],
      "snapshot_restore": [
        "tests/storage/snapshots/test_snapshots.py:TestRestoreSnapshots",
        "tests/chaos/snapshot/test_snapshot.py:test_pod_delete_snapshot"
      ],
      "volume_snapshot_class": [
        "utilities/storage.py:is_snapshot_supported_by_sc"
      ]
    }
  },
  "patterns": {
    "resource_creation": "Use context managers (with statements) for automatic cleanup",
    "vm_testing": "VirtualMachineForTests with ssh=True for connectivity tests",
    "snapshot_workflow": "Create VMSnapshot -> wait_snapshot_done() -> VirtualMachineRestore -> wait_restore_done()",
    "parametrization": "Use indirect=['fixture_name'] for fixture parametrization",
    "storage_matrix": "Use storage_class_matrix__scope__ fixtures for multi-storage testing",
    "wait_patterns": "Use TimeoutSampler for polling operations",
    "error_handling": "pytest.raises(Exception, match=r'pattern') for expected errors",
    "module_markers": "pytestmark = pytest.mark.usefixtures(...) for module-wide fixtures"
  },
  "testing_domains": {
    "storage": {
      "path": "tests/storage/",
      "features": [
        "snapshots",
        "datavolumes",
        "storage_class",
        "checkups",
        "golden_image",
        "clone"
      ]
    },
    "virt": {
      "path": "tests/virt/",
      "features": [
        "cluster",
        "lifecycle",
        "migration",
        "node_maintenance"
      ]
    },
    "network": {
      "path": "tests/network/",
      "features": [
        "connectivity",
        "nad",
        "multus"
      ]
    }
  },
  "code_style": {
    "line_length": 120,
    "formatter": "black",
    "linter": "ruff",
    "type_checker": "mypy",
    "import_order": "pytest, kubernetes, ocp_resources, utilities, local tests imports",
    "string_quotes": "double quotes preferred",
    "type_hints": "use typing module for Optional, List, Dict, Any"
  },
  "context_version": "1.0",
  "generated": "2026-02-03"
}
